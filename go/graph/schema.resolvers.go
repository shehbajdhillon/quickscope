package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.41

import (
	"context"
	"fmt"
	"quickscopedev/auth"
	"quickscopedev/database"
	"quickscopedev/graph/model"
)

// TeamID is the resolver for the teamId field.
func (r *integrationResolver) TeamID(ctx context.Context, obj *database.Integration) (int64, error) {
	if obj.TeamID.Valid == false {
		return -1, nil
	}
	return obj.TeamID.Int64, nil
}

// CreateMonitor is the resolver for the createMonitor field.
func (r *mutationResolver) CreateMonitor(ctx context.Context, input model.NewMonitor) (database.Monitor, error) {
	panic(fmt.Errorf("not implemented: CreateMonitor - createMonitor"))
}

// AddIntegration is the resolver for the addIntegration field.
func (r *mutationResolver) AddIntegration(ctx context.Context, input model.NewIntegration) (database.Integration, error) {
	panic(fmt.Errorf("not implemented: AddIntegration - addIntegration"))
}

// Teams is the resolver for the teams field.
func (r *queryResolver) Teams(ctx context.Context, teamSlug *string) ([]database.Team, error) {
	email, _ := auth.EmailFromContext(ctx)
	user, _ := r.Database.GetUserByEmail(ctx, email)

	if teamSlug != nil {
		team, err := r.Database.GetTeamByTeamSlug(ctx, *teamSlug)
		r.Database.UpdateUserLastAccessedTeam(ctx, database.UpdateUserLastAccessedTeamParams{
			UserID:             user.ID,
			LastAccessedTeamID: team.ID,
		})
		return []database.Team{team}, err
	}

	return r.Database.GetTeamsByUserId(ctx, user.ID)
}

// TeamType is the resolver for the teamType field.
func (r *teamResolver) TeamType(ctx context.Context, obj *database.Team) (string, error) {
	return string(obj.TeamType), nil
}

// Monitors is the resolver for the monitors field.
func (r *teamResolver) Monitors(ctx context.Context, obj *database.Team, monitorSlug *string) ([]database.Monitor, error) {
	if monitorSlug != nil {
		monitor, err := r.Database.GetMonitorByTeamIdAndMonitorSlug(ctx,
			database.GetMonitorByTeamIdAndMonitorSlugParams{
				TeamID:      obj.ID,
				MonitorSlug: *monitorSlug,
			},
		)
		return []database.Monitor{monitor}, err
	}

	return r.Database.GetMonitorsByTeamId(ctx, obj.ID)
}

// Integration returns IntegrationResolver implementation.
func (r *Resolver) Integration() IntegrationResolver { return &integrationResolver{r} }

// Mutation returns MutationResolver implementation.
func (r *Resolver) Mutation() MutationResolver { return &mutationResolver{r} }

// Query returns QueryResolver implementation.
func (r *Resolver) Query() QueryResolver { return &queryResolver{r} }

// Team returns TeamResolver implementation.
func (r *Resolver) Team() TeamResolver { return &teamResolver{r} }

type integrationResolver struct{ *Resolver }
type mutationResolver struct{ *Resolver }
type queryResolver struct{ *Resolver }
type teamResolver struct{ *Resolver }
